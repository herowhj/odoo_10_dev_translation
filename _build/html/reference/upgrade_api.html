<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>升级接口(Upgrade API) &mdash; odoo 10.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="odoo 10.0 documentation" href="../index.html" />
    <link rel="up" title="Reference" href="../reference.html" />
    <link rel="next" title="Business Mementoes" href="../business.html" />
    <link rel="prev" title="Odoo 指南" href="guidelines.html" /> 
  </head>
  <body role="document"><header class="o_main_header o_has_sub_nav o_inverted has_code_col">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting/">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management/">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">升级接口(Upgrade API)</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            

<li><a href="http://www.odoo.com/documentation/user/10.0/index.html">User</a></li>
<li><a href="http://www.odoo.com/documentation/10.0/index.html">Developer</a></li>
<li><a href="http://www.odoo.com/documentation/10.0/api_integration.html">API</a></li>
<li><a href="http://www.odoo.com/documentation/10.0/setup/install.html">Installation</a></li>
<li><a href="http://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="http://www.odoo.com/page/legal">Legal</a></li>
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="has_code_col">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/upgrade_api.jpg');"></span>
      <div class="container text-center">
        <h1> 升级接口(Upgrade API) </h1>
      </div>
    </figure>
    
    
    
    <div class="container-fluid has_code_col">
      <main class="container-fluid has_code_col">
        
        <div class="row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="list-group text-left nav"><li class="list-group-item"><a href="#id1" class="ripple internal reference">简介</a></li><li class="list-group-item"><a href="#method" class="ripple internal reference">方法(method)</a><ul ><li class="list-group-item"><a href="#upgrade-api-create-method" class="ripple internal reference">创建一个数据库升级请求</a><ul ><li class="list-group-item"><a href="#create" class="ripple internal reference">介绍 <code >创建(create)</code> 的方法</a><ul ><li class="list-group-item"><a href="#failures" class="ripple internal reference"><code >失败(failures)</code></a></li><li class="list-group-item"><a href="#request" class="ripple internal reference"><code >请求(request)</code></a></li><li class="list-group-item"><a href="#sample-script" class="ripple internal reference">示例脚本(Sample script)</a></li></ul></li></ul></li><li class="list-group-item"><a href="#dump" class="ripple internal reference">上传你的数据库快照(dump)</a><ul ><li class="list-group-item"><a href="#upload" class="ripple internal reference"><code >upload</code> 方法</a></li><li class="list-group-item"><a href="#request-sftp-access" class="ripple internal reference"><code >request_sftp_access</code> 方法</a><ul ><li class="list-group-item"><a href="#id3" class="ripple internal reference"><code >失败(failures)</code></a></li><li class="list-group-item"><a href="#id4" class="ripple internal reference"><code >请求(request)</code></a><ul ><li class="list-group-item"><a href="#sftp" class="ripple internal reference">使用 'sftp' 客户端</a></li></ul></li></ul></li></ul></li><li class="list-group-item"><a href="#upgrade-api-process-method" class="ripple internal reference">请求处理你的请求</a><ul ><li class="list-group-item"><a href="#process" class="ripple internal reference"><code >处理(process)</code> 方法</a></li></ul></li><li class="list-group-item"><a href="#upgrade-api-status-method" class="ripple internal reference">获得你的请求状态</a><ul ><li class="list-group-item"><a href="#status" class="ripple internal reference"><code >status</code> 方法</a></li><li class="list-group-item"><a href="#id7" class="ripple internal reference">输出示例</a></li></ul></li><li class="list-group-item"><a href="#upgrade-api-download-method" class="ripple internal reference">下载你的数据库快照</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/10.0/doc/reference/upgrade_api.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="upgrade-api"><i id="reference-upgrade-api"></i></section><section id="id1"><h2 >简介</h2><p >这份文档描述了升级Odoo的数据库至一个更新的版本的接口(API).</p><p >它允许升级一个数据库而不必依赖位于
<a href="https://upgrade.odoo.com" class="external reference">https://upgrade.odoo.com</a>
html的表格, 虽然数据库还是会遵从那个表格描述的相同的流程.</p><p >需要的步骤如下:</p><ul ><li ><a href="#upgrade-api-create-method" class="internal reference"><span class="std std-ref">创建一个请求</span></a></li><li ><a href="#upgrade-api-upload-method" class="internal reference"><span class="std std-ref">上传数据库快照(dump)</span></a></li><li ><a href="#upgrade-api-process-method" class="internal reference"><span class="std std-ref">运行升级流程</span></a></li><li ><a href="#upgrade-api-status-method" class="internal reference"><span class="std std-ref">获得数据库请求的状态</span></a></li><li ><a href="#upgrade-api-download-method" class="internal reference"><span class="std std-ref">下载升级的数据库快照(dump)</span></a></li></ul></section><section id="method"><h2 >方法(method)</h2></section><section id="upgrade-api-create-method"><i id="id2"></i><h3 >创建一个数据库升级请求</h3><p >这个动作创建一个需要如下信息的数据库请求:</p><ul ><li >你的合同参考</li><li >你的邮件地址</li><li >目标版本 (你想升级至的 Odoo 版本)</li><li >你的请求的目的 (测试或生产环境)</li><li >数据库快照的名字 (必需但只是补充性的)</li><li >可选的服务器时区 (针对 Odoo 源版本 &lt; 6.1)</li></ul></section><section id="create"><h4 >介绍 <code >创建(create)</code> 的方法</h4><section class="code-function"><h6 ><code>https://upgrade.odoo.com/database/v1/create</code></h6><p >创建一个数据库升级请求</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Parameters</div><div class="code-field-body"><ul ><li ><strong >contract</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需) 企业的合同号码</li><li ><strong >email</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需) 邮件地址</li><li ><strong >target</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需) 你想要升级至的Odoo的版本. 有效的选项是: 6.0, 6.1, 7.0, 8.0</li><li ><strong >aim</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需) 你升级数据库请求的目的. 有效的选项是: 测试, 生产.</li><li ><strong >filename</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需) 一个你的数据库快照文件的纯粹的补充性的名字</li><li ><strong >timezone</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (可选) 你服务器使用的时区. 只针对Odoo源版本 &lt; 6.1</li></ul></div></div><div class="code-field"><div class="code-field-name">Returns</div><div class="code-field-body">请求的结果</div></div><div class="code-field"><div class="code-field-name">Return type</div><div class="code-field-body">JSON 字典</div></div></div></section><p >这个 <em >创建(create)</em> 的方法返回一个如下键值的JSON字典:</p></section><section id="failures"><i id="upgrade-api-json-failure"></i><h5 ><code >失败(failures)</code></h5><p >包含错误的一个列表.</p><p >一个字典的列表, 每个字典给出一个特定错误的信息.
每个字典依据不同的错误类型可以包含不同的键值
但是你总是会获得 <code >原因(reason)</code> 和 <code >消息(message)</code> 两个键:</p><ul ><li ><code >reason</code>: 错误的类型</li><li ><code >message</code>: 易于阅读的信息</li></ul><p >一些可能的键值:</p><ul ><li ><code >code</code>: 一个错误值</li><li ><code >value</code>: 一个错误值</li><li ><code >expected</code>: 一个包含有效值的列表</li></ul><p >查看一侧的示例.</p><div class="doc-aside content-switcher setup"><ul ><li >JSON</li></ul><div class="tabs"><div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;expected&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;6.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;7.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;8.0&quot;</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid value \&quot;5.0\&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;TARGET:INVALID&quot;</span><span class="p">,</span>
      <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5.0&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;M123456-abcxyz&quot;</span><span class="p">,</span>
      <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Can not find contract M123456-abcxyz&quot;</span><span class="p">,</span>
      <span class="nt">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;CONTRACT:NOT_FOUND&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div></section><section id="request"><h5 ><code >请求(request)</code></h5><p >如果 <em >创建(create)</em> 方法成功了, <em >请求(request)</em> 的键对应的值将会是一个
包含创建请求的各种信息的字典:</p><p >最重要的键值是:</p><ul ><li ><code >id</code>: 请求的id</li><li ><code >key</code>: 你的这次请求的私人键值</li></ul><p >这两个值会被其他方法使用(上传, 处理和状态)</p><p >其他的键值会在介绍 <a href="#upgrade-api-status-method" class="internal reference"><span class="std std-ref">状态方法</span></a> 的时候进行介绍.</p></section><section id="sample-script"><h5 >示例脚本(Sample script)</h5><p >这里有建立数据库升级请求的两个示例, 使用如下的方法:</p><ul ><li >一个使用的是python编程语言里的pycurl库</li><li >一个使用的是bash编程语言里的 <a href="http://curl.haxx.se" class="external reference">curl</a> (使用http传输数据的工具)
和 <a href="https://stedolan.github.io/jq" class="external reference">jq</a> (JSON 处理程序):</li></ul><div class="doc-aside content-switcher setup"><ul ><li >Python</li><li >Bash</li></ul><div class="tabs"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">pycurl</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">CREATE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://upgrade.odoo.com/database/v1/create&quot;</span>
<span class="n">CONTRACT</span> <span class="o">=</span> <span class="s2">&quot;M123456-abcdef&quot;</span>
<span class="n">AIM</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
<span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;8.0&quot;</span>
<span class="n">EMAIL</span> <span class="o">=</span> <span class="s2">&quot;john.doe@example.com&quot;</span>
<span class="n">FILENAME</span> <span class="o">=</span> <span class="s2">&quot;db_name.dump&quot;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;aim&#39;</span><span class="p">,</span> <span class="n">AIM</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">DB_SOURCE</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;contract&#39;</span><span class="p">,</span> <span class="n">CONTRACT</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">postfields</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">CREATE_URL</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">POSTFIELDS</span><span class="p">,</span> <span class="n">postfields</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

<span class="c1"># transform output into a dict:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="c1"># get http status:</span>
<span class="n">http_code</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTP_CODE</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">CONTRACT</span><span class="o">=</span>M123456-abcdef
<span class="nv">AIM</span><span class="o">=</span><span class="nb">test</span>
<span class="nv">TARGET</span><span class="o">=</span><span class="m">8</span>.0
<span class="nv">EMAIL</span><span class="o">=</span>john.doe@example.com
<span class="nv">FILENAME</span><span class="o">=</span>db_name.dump
<span class="nv">CREATE_URL</span><span class="o">=</span><span class="s2">&quot;https://upgrade.odoo.com/database/v1/create&quot;</span>
<span class="nv">URL_PARAMS</span><span class="o">=</span><span class="s2">&quot;contract=</span><span class="si">${</span><span class="nv">CONTRACT</span><span class="si">}</span><span class="s2">&amp;aim=</span><span class="si">${</span><span class="nv">AIM</span><span class="si">}</span><span class="s2">&amp;target=</span><span class="si">${</span><span class="nv">TARGET</span><span class="si">}</span><span class="s2">&amp;email=</span><span class="si">${</span><span class="nv">EMAIL</span><span class="si">}</span><span class="s2">&amp;filename=</span><span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span><span class="s2">&quot;</span>
curl -sS <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CREATE_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">${</span><span class="nv">URL_PARAMS</span><span class="si">}</span><span class="s2">&quot;</span> &gt; create_result.json

<span class="c1"># check for failures</span>
<span class="nv">failures</span><span class="o">=</span><span class="k">$(</span>cat create_result.json <span class="p">|</span> jq -r <span class="s1">&#39;.failures[]&#39;</span><span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$failures</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$failures</span> <span class="p">|</span> jq -r <span class="s1">&#39;.&#39;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>
</pre></div>
</div>
</div></div></section><section id="dump"><i id="upgrade-api-upload-method"></i><h3 >上传你的数据库快照(dump)</h3><p >有两个方法来上传你的数据库快照:</p><ul ><li ><code >upload</code> 方法使用的是HTTPS协议</li><li ><code >request_sftp_access</code> 方法使用的是SFTP协议</li></ul></section><section id="upload"><h4 ><code >upload</code> 方法</h4><p >对于上传你的数据库快照来说, 这是最简单和最直接的方法, 它使用 HTTPS 协议.</p><section class="code-function"><h6 ><code>https://upgrade.odoo.com/database/v1/upload</code></h6><p >上传一个数据库快照</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Parameters</div><div class="code-field-body"><ul ><li ><strong >key</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的私人键值</li><li ><strong >request</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的请求id</li></ul></div></div><div class="code-field"><div class="code-field-name">Returns</div><div class="code-field-body">请求的结果</div></div><div class="code-field"><div class="code-field-name">Return type</div><div class="code-field-body">JSON字典</div></div></div></section><p >请求的id和私人的键值是通过 <a href="#upgrade-api-create-method" class="internal reference"><span class="std std-ref">create method</span></a> 方法获得的</p><p >结果是一个JSON字典, 它包含了一个 <code >失败(failures)</code> 的列表, 如果一切顺利的话它应该为空.</p><div class="doc-aside content-switcher setup"><ul ><li >Python</li><li >Bash</li></ul><div class="tabs"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pycurl</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>

<span class="n">UPLOAD_URL</span> <span class="o">=</span> <span class="s2">&quot;https://upgrade.odoo.com/database/v1/upload&quot;</span>
<span class="n">DUMPFILE</span> <span class="o">=</span> <span class="s2">&quot;openchs.70.cdump&quot;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="s1">&#39;10534&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Aw7pItGVKFuZ_FOR3U8VFQ==&#39;</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">}</span>
<span class="n">postfields</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">UPLOAD_URL</span><span class="o">+</span><span class="s2">&quot;?&quot;</span><span class="o">+</span><span class="n">postfields</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">filesize</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">DUMPFILE</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">POSTFIELDSIZE</span><span class="p">,</span> <span class="n">filesize</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DUMPFILE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">READFUNCTION</span><span class="p">,</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span>
    <span class="n">pycurl</span><span class="o">.</span><span class="n">HTTPHEADER</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">headers</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">])</span>

<span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">UPLOAD_URL</span><span class="o">=</span><span class="s2">&quot;https://upgrade.odoo.com/database/v1/upload&quot;</span>
<span class="nv">DUMPFILE</span><span class="o">=</span><span class="s2">&quot;openchs.70.cdump&quot;</span>
<span class="nv">KEY</span><span class="o">=</span><span class="s2">&quot;Aw7pItGVKFuZ_FOR3U8VFQ==&quot;</span>
<span class="nv">REQUEST_ID</span><span class="o">=</span><span class="s2">&quot;10534&quot;</span>
<span class="nv">URL_PARAMS</span><span class="o">=</span><span class="s2">&quot;key=</span><span class="si">${</span><span class="nv">KEY</span><span class="si">}</span><span class="s2">&amp;request=</span><span class="si">${</span><span class="nv">REQUEST_ID</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">HEADER</span><span class="o">=</span><span class="s2">&quot;Content-Type: application/octet-stream&quot;</span>
curl -H <span class="nv">$HEADER</span> --data-binary <span class="s2">&quot;@</span><span class="si">${</span><span class="nv">DUMPFILE</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">UPLOAD_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">${</span><span class="nv">URL_PARAMS</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></div></section><section id="request-sftp-access"><i id="upgrade-api-request-sftp-access-method"></i><h4 ><code >request_sftp_access</code> 方法</h4><p >这个方法推荐用于大的数据库快照.
它使用SFTP协议并支持断点续传.</p><p >它会新建一个临时的SFTP服务器, 通过它你可以链接并且允许你上传你的数据库快照来使用SFTP客户端.</p><section class="code-function"><h6 ><code>https://upgrade.odoo.com/database/v1/request_sftp_access</code></h6><p >新建一个SFTP服务器</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Parameters</div><div class="code-field-body"><ul ><li ><strong >key</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的私人键值</li><li ><strong >request</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的请求id</li><li ><strong >ssh_keys</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)指向你要使用的ssh公共秘钥的文件路径</li></ul></div></div><div class="code-field"><div class="code-field-name">Returns</div><div class="code-field-body">请求的结果</div></div><div class="code-field"><div class="code-field-name">Return type</div><div class="code-field-body">JSON字典</div></div></div></section><p >请求的id和私人的键值是通过 <a href="#upgrade-api-create-method" class="internal reference"><span class="std std-ref">create method</span></a> 方法获得的</p><p >列出你的ssh公共秘钥的文件应该类似于一个标准的 <code >authorized_keys</code> 文件.
这个文件应该只包含公共秘钥, 空白行或注释(以 <code >#</code> 字符开头的行)</p><p >你的数据库升级请求应该处于 <code >初步(draft)</code> 状态.</p><p ><code >request_sftp_access</code> 方法返回一个JSON字典,它包含如下的键值:</p><div class="doc-aside content-switcher setup"><ul ><li >Python</li><li >Bash</li></ul><div class="tabs"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pycurl</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>

<span class="n">UPLOAD_URL</span> <span class="o">=</span> <span class="s2">&quot;https://upgrade.odoo.com/database/v1/request_sftp_access&quot;</span>
<span class="n">SSH_KEYS</span><span class="o">=</span><span class="s2">&quot;/path/to/your/authorized_keys&quot;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="s1">&#39;10534&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Aw7pItGVKFuZ_FOR3U8VFQ==&#39;</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">postfields</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">UPLOAD_URL</span><span class="o">+</span><span class="s2">&quot;?&quot;</span><span class="o">+</span><span class="n">postfields</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">HTTPPOST</span><span class="p">,[(</span><span class="s2">&quot;ssh_keys&quot;</span><span class="p">,</span>
                        <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">FORM_FILE</span><span class="p">,</span> <span class="n">SSH_KEYS</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">FORM_CONTENTTYPE</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">))</span>
                    <span class="p">])</span>

<span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">REQUEST_SFTP_ACCESS_URL</span><span class="o">=</span><span class="s2">&quot;https://upgrade.odoo.com/database/v1/request_sftp_access&quot;</span>
<span class="nv">SSH_KEYS</span><span class="o">=</span>/path/to/your/authorized_keys
<span class="nv">KEY</span><span class="o">=</span><span class="s2">&quot;Aw7pItGVKFuZ_FOR3U8VFQ==&quot;</span>
<span class="nv">REQUEST_ID</span><span class="o">=</span><span class="s2">&quot;10534&quot;</span>
<span class="nv">URL_PARAMS</span><span class="o">=</span><span class="s2">&quot;key=</span><span class="si">${</span><span class="nv">KEY</span><span class="si">}</span><span class="s2">&amp;request=</span><span class="si">${</span><span class="nv">REQUEST_ID</span><span class="si">}</span><span class="s2">&quot;</span>

curl -sS <span class="s2">&quot;</span><span class="si">${</span><span class="nv">REQUEST_SFTP_ACCESS_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">${</span><span class="nv">URL_PARAMS</span><span class="si">}</span><span class="s2">&quot;</span> -F <span class="nv">ssh_keys</span><span class="o">=</span>@<span class="si">${</span><span class="nv">SSH_KEYS</span><span class="si">}</span> &gt; request_sftp_result.json

<span class="c1"># check for failures</span>
<span class="nv">failures</span><span class="o">=</span><span class="k">$(</span>cat request_sftp_result.json <span class="p">|</span> jq -r <span class="s1">&#39;.failures[]&#39;</span><span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$failures</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="nv">$failures</span> <span class="p">|</span> jq -r <span class="s1">&#39;.&#39;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>
</pre></div>
</div>
</div></div></section><section id="id3"><h5 ><code >失败(failures)</code></h5><p >一个包含错误的列表. 查看 <a href="#upgrade-api-json-failure" class="internal reference"><span class="std std-ref">failures</span></a> ,
里面包含了对在失败情况下返回的JSON字典的解释.</p></section><section id="id4"><h5 ><code >请求(request)</code></h5><p >如果调用成功了,关联到 <em >请求(request)</em> 键的值会是一个包含你的SFTP链接参数的字典:</p><ul ><li ><code >hostname</code>: 链接的主机地址</li><li ><code >sftp_port</code>: 链接的端口</li><li ><code >sftp_user</code>: 用于链接SFTP的用户</li><li ><code >shared_file</code>: 你使用的文件名 (与当你在创建 <a href="#upgrade-api-create-method" class="internal reference"><span class="std std-ref">create method</span></a> 请求时使用的 <code >filename</code> 值是一样的)</li><li ><code >request_id</code>: 相关的升级请求id (只是补充信息, 对于链接来说非必须)</li><li ><code >sample_command</code>: 一个使用 'sftp' 客户端的示例命令</li></ul><p >在正常情况下,你应该可以使用示例命令链接.</p><p >你只能访问 <code >shared_file</code>. 其他文件你都不能访问,
并且你不能在你的SFTP服务器上的共享环境中新建一个新的文件.</p></section><section id="sftp"><h6 >使用 'sftp' 客户端</h6><p >一旦你适应你的SFTP客户端成功的链接, 你可以上传你的数据库快照.
下面是使用 'sftp' 客户端的一个示例对话:</p><div class="highlight-default"><div class="highlight"><pre><span></span>$ sftp -P 2200 user_10534@upgrade.odoo.com
Connected to upgrade.odoo.com.
sftp&gt; put /path/to/openchs.70.cdump openchs.70.cdump
Uploading /path/to/openchs.70.cdump to /openchs.70.cdump
sftp&gt; ls -l openchs.70.cdump
-rw-rw-rw-    0 0        0          849920 Aug 30 15:58 openchs.70.cdump
</pre></div>
</div>
<p >如果你的连接中断了, 你可以继续传输你的文件,只需要在命令行里面加入 <code >-a</code> :</p><div class="highlight-text"><div class="highlight"><pre><span></span>sftp&gt; put -a /path/to/openchs.70.cdump openchs.70.cdump
Resuming upload of /path/to/openchs.70.cdump to /openchs.70.cdump
</pre></div>
</div>
<p >如果你不想手动输入这个命令并且需要使用脚本自动化你的数据库升级, 你可以使用一个batch文件或者把你的命令pipe至'sftp':</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;put /path/to/openchs.70.cdump openchs.70.cdump&quot;</span> <span class="o">|</span> <span class="n">sftp</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="o">-</span><span class="n">P</span> <span class="mi">2200</span> <span class="n">user_10534</span><span class="nd">@upgrade</span><span class="o">.</span><span class="n">odoo</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p >参数 <code >-b</code> 需要一个文件名. 如果文件名是 <code >-</code>, 他就从标准输入来读取命令.</p></section><section id="upgrade-api-process-method"><i id="id5"></i><h3 >请求处理你的请求</h3><p >请求升级平台来处理你的数据库快照的动作.</p></section><section id="process"><h4 ><code >处理(process)</code> 方法</h4><section class="code-function"><h6 ><code>https://upgrade.odoo.com/database/v1/process</code></h6><p >处理一个数据库快照</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Parameters</div><div class="code-field-body"><ul ><li ><strong >key</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的私人键值</li><li ><strong >request</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的请求id</li></ul></div></div><div class="code-field"><div class="code-field-name">Returns</div><div class="code-field-body">请求的结果</div></div><div class="code-field"><div class="code-field-name">Return type</div><div class="code-field-body">JSON字典</div></div></div></section><p >请求的id和私人的键值是通过 <a href="#upgrade-api-create-method" class="internal reference"><span class="std std-ref">create method</span></a> 方法获得的</p><p >结果是一个JSON字典, 它包含了一个 <code >失败(failures)</code> 的列表, 如果一切顺利的话它应该为空.</p><div class="doc-aside content-switcher setup"><ul ><li >Python</li><li >Bash</li></ul><div class="tabs"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">pycurl</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">PROCESS_URL</span> <span class="o">=</span> <span class="s2">&quot;https://upgrade.odoo.com/database/v1/process&quot;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="s1">&#39;10534&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Aw7pItGVKFuZ_FOR3U8VFQ==&#39;</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">postfields</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">PROCESS_URL</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">POSTFIELDS</span><span class="p">,</span> <span class="n">postfields</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

<span class="c1"># transform output into a dict:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="c1"># get http status:</span>
<span class="n">http_code</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">HTTP_CODE</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PROCESS_URL</span><span class="o">=</span><span class="s2">&quot;https://upgrade.odoo.com/database/v1/process&quot;</span>
<span class="nv">KEY</span><span class="o">=</span><span class="s2">&quot;Aw7pItGVKFuZ_FOR3U8VFQ==&quot;</span>
<span class="nv">REQUEST_ID</span><span class="o">=</span><span class="s2">&quot;10534&quot;</span>
<span class="nv">URL_PARAMS</span><span class="o">=</span><span class="s2">&quot;key=</span><span class="si">${</span><span class="nv">KEY</span><span class="si">}</span><span class="s2">&amp;request=</span><span class="si">${</span><span class="nv">REQUEST_ID</span><span class="si">}</span><span class="s2">&quot;</span>
curl -sS <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROCESS_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">${</span><span class="nv">URL_PARAMS</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></div></section><section id="upgrade-api-status-method"><i id="id6"></i><h3 >获得你的请求状态</h3><p >这个动作查询你数据库升级请求的状态.</p></section><section id="status"><h4 ><code >status</code> 方法</h4><section class="code-function"><h6 ><code>https://upgrade.odoo.com/database/v1/status</code></h6><p >查询一个数据库升级请求的状态</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Parameters</div><div class="code-field-body"><ul ><li ><strong >key</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的私人键值</li><li ><strong >request</strong> (<a href="https://docs.python.org/2/library/functions.html#str" class="external reference alert-link" title="(in Python v2.7)"><code >str</code></a>) -- (必需)你的请求id</li></ul></div></div><div class="code-field"><div class="code-field-name">Returns</div><div class="code-field-body">请求的结果</div></div><div class="code-field"><div class="code-field-name">Return type</div><div class="code-field-body">JSON字典</div></div></div></section><p >请求的id和私人的键值是通过 <a href="#upgrade-api-create-method" class="internal reference"><span class="std std-ref">create method</span></a> 方法获得的</p><p >结果是一个包含你的数据库升级请求的各种信息的JSON字典.</p><div class="doc-aside content-switcher setup"><ul ><li >Python</li><li >Bash</li></ul><div class="tabs"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">pycurl</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">STATUS_URL</span> <span class="o">=</span> <span class="s2">&quot;https://upgrade.odoo.com/database/v1/status&quot;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="s1">&#39;10534&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Aw7pItGVKFuZ_FOR3U8VFQ==&#39;</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">postfields</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">PROCESS_URL</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">POSTFIELDS</span><span class="p">,</span> <span class="n">postfields</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

<span class="c1"># transform output into a dict:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">STATUS_URL</span><span class="o">=</span><span class="s2">&quot;https://upgrade.odoo.com/database/v1/status&quot;</span>
<span class="nv">KEY</span><span class="o">=</span><span class="s2">&quot;Aw7pItGVKFuZ_FOR3U8VFQ==&quot;</span>
<span class="nv">REQUEST_ID</span><span class="o">=</span><span class="s2">&quot;10534&quot;</span>
<span class="nv">URL_PARAMS</span><span class="o">=</span><span class="s2">&quot;key=</span><span class="si">${</span><span class="nv">KEY</span><span class="si">}</span><span class="s2">&amp;request=</span><span class="si">${</span><span class="nv">REQUEST_ID</span><span class="si">}</span><span class="s2">&quot;</span>
curl -sS <span class="s2">&quot;</span><span class="si">${</span><span class="nv">STATUS_URL</span><span class="si">}</span><span class="s2">?</span><span class="si">${</span><span class="nv">URL_PARAMS</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></div></section><section id="id7"><h4 >输出示例</h4><p ><code >请求(request)</code> 键包含很多关于你请求的有用的信息:</p><dl ><dt ><code >id</code></dt><dd >请求id</dd><dt ><code >key</code></dt><dd >你的私人键值</dd><dt ><code >email</code></dt><dd >当创建请求的时候你输入的邮件地址</dd><dt ><code >target</code></dt><dd >你创建请求时输入的Odoo的目标版本</dd><dt ><code >aim</code></dt><dd >在创建请求时输入的你数据库升级请求的目的(测试, 生产)</dd><dt ><code >filename</code></dt><dd >创建请求时提供的文件名</dd><dt ><code >timezone</code></dt><dd >创建请求时提供的时区</dd><dt ><code >state</code></dt><dd >请求的状态</dd><dt ><code >issue_stage</code></dt><dd >在Odoo主服务器上问题的阶段</dd><dt ><code >issue</code></dt><dd >在Odoo主服务器上的问题id</dd><dt ><code >status_url</code></dt><dd >访问你的数据库升级请求的html页面的URL</dd><dt ><code >notes_url</code></dt><dd >获得你的数据库升级请求的注释的URL</dd><dt ><code >original_sql_url</code></dt><dd >用于把你上传的数据库(未升级)作为一个SQL流而取得的URL</dd><dt ><code >original_dump_url</code></dt><dd >用于把你上传的数据库(未升级)作为一个压缩文件而取得的URL</dd><dt ><code >upgraded_sql_url</code></dt><dd >用于把你上传的数据库作为一个SQL流而取得的URL</dd><dt ><code >upgraded_dump_url</code></dt><dd >用于把你上传的数据库作为一个压缩文件而取得的URL</dd><dt ><code >modules_url</code></dt><dd >获取你的自定义模块的URL</dd><dt ><code >filesize</code></dt><dd >你上传的数据库文件的大小</dd><dt ><code >database_uuid</code></dt><dd >你的数据库的唯一ID</dd><dt ><code >created_at</code></dt><dd >在你创建请求时的日期</dd><dt ><code >estimated_time</code></dt><dd >升级你的数据库的估计时间</dd><dt ><code >processed_at</code></dt><dd >你的数据库升级开始的时间</dd><dt ><code >elapsed</code></dt><dd >升级你的数据库已经消耗的时间</dd><dt ><code >filestore</code></dt><dd >你的附件转换为了存储文件</dd><dt ><code >customer_message</code></dt><dd >关于你的请求的一个重要信息</dd><dt ><code >database_version</code></dt><dd >你上传的数据库(未升级)的一个猜测版本</dd><dt ><code >postgresql</code></dt><dd >你上传的数据库(未升级)的一个猜测的Postgresql版本</dd><dt ><code >compressions</code></dt><dd >你上传的数据库的压缩方法</dd></dl><div class="doc-aside content-switcher setup"><ul ><li >JSON</li></ul><div class="tabs"><div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10534</span><span class="p">,</span>
    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Aw7pItGVKFuZ_FOR3U8VFQ==&quot;</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;john.doe@example.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;8.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;aim&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="nt">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;db_name.dump&quot;</span><span class="p">,</span>
    <span class="nt">&quot;timezone&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
    <span class="nt">&quot;issue_stage&quot;</span><span class="p">:</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span>
    <span class="nt">&quot;issue&quot;</span><span class="p">:</span> <span class="mi">648398</span><span class="p">,</span>
    <span class="nt">&quot;status_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/status&quot;</span><span class="p">,</span>
    <span class="nt">&quot;notes_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/upgraded/notes&quot;</span><span class="p">,</span>
    <span class="nt">&quot;original_sql_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/original/sql&quot;</span><span class="p">,</span>
    <span class="nt">&quot;original_dump_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/original/archive&quot;</span><span class="p">,</span>
    <span class="nt">&quot;upgraded_sql_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/upgraded/sql&quot;</span><span class="p">,</span>
    <span class="nt">&quot;upgraded_dump_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/upgraded/archive&quot;</span><span class="p">,</span>
    <span class="nt">&quot;modules_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://upgrade.odoo.com/database/eu1/10534/Aw7pItGVKFuZ_FOR3U8VFQ==/modules/archive&quot;</span><span class="p">,</span>
    <span class="nt">&quot;filesize&quot;</span><span class="p">:</span> <span class="s2">&quot;912.99 Kb&quot;</span><span class="p">,</span>
    <span class="nt">&quot;database_uuid&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-09-09 07:13:49&quot;</span><span class="p">,</span>
    <span class="nt">&quot;estimated_time&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;processed_at&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;elapsed&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00&quot;</span><span class="p">,</span>
    <span class="nt">&quot;filestore&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;customer_message&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;database_version&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;postgresql&quot;</span><span class="p">:</span> <span class="s2">&quot;9.4&quot;</span><span class="p">,</span>
    <span class="nt">&quot;compressions&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;pgdmp_custom&quot;</span><span class="p">,</span>
      <span class="s2">&quot;sql&quot;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></div></section><section id="upgrade-api-download-method"><i id="id8"></i><h3 >下载你的数据库快照</h3><p >除了使用 <a href="#upgrade-api-status-method" class="internal reference"><span class="std std-ref">status method</span></a> 提供的URL来下载你已经迁移的数据库以外,
你也可以使用 <a href="#upgrade-api-request-sftp-access-method" class="internal reference"><span class="std std-ref">request_sftp_access method</span></a> 描述的SFTP协议</p><p >区别是你只能下载迁移的数据库. 不能上传.</p><p >你的数据库升级请求应该处于 <code >完成(done)</code> 状态.</p><p >一旦你成功的使用你的SFTP客户端连接了, 你就可以下载你的数据库快照.
下面有一个使用'sftp'客户端的示例对话:</p><div class="highlight-default"><div class="highlight"><pre><span></span>$ sftp -P 2200 user_10534@upgrade.odoo.com
Connected to upgrade.odoo.com.
sftp&gt; get upgraded_openchs.70.cdump /path/to/upgraded_openchs.70.cdump
Downloading /upgraded_openchs.70.cdump to /path/to/upgraded_openchs.70.cdump
</pre></div>
</div>
</section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
    </div>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="http://www.odoo.com/pricing">Editions</a></li>
                <li><a href="http://www.odoo.com/pricing-online">Cloud Pricing</a></li>
                <li><a href="http://www.odoo.com/page/upgrade">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog/">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  </body>
</html>